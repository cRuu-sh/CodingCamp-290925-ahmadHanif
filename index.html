<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List App</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px 0;
      }
      .container {
        max-width: 800px;
      }
      .card {
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }
      .task-item {
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
      }
      .task-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .task-completed {
        opacity: 0.6;
        text-decoration: line-through;
      }
      .deadline-passed {
        border-left-color: #dc3545;
      }
      .deadline-today {
        border-left-color: #ffc107;
      }
      .btn-action {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h2 class="mb-0"><i class="fas fa-tasks"></i> My To-Do List</h2>
        </div>
        <div class="card-body">
          <!-- Add Task Form -->
          <form id="taskForm" class="mb-4">
            <div class="row g-3">
              <div class="col-md-6">
                <input
                  type="text"
                  class="form-control"
                  id="taskInput"
                  placeholder="Enter task..."
                  required
                />
              </div>
              <div class="col-md-4">
                <input
                  type="date"
                  class="form-control"
                  id="deadlineInput"
                  required
                />
              </div>
              <div class="col-md-2">
                <button
                  type="submit"
                  class="btn btn-success w-100"
                  id="submitBtn"
                >
                  <i class="fas fa-plus"></i> Add
                </button>
              </div>
            </div>
          </form>

          <!-- Filter and Sort Controls -->
          <div class="row g-2 mb-3">
            <div class="col-md-6">
              <select class="form-select" id="filterSelect">
                <option value="all">All Tasks</option>
                <option value="active">Active Tasks</option>
                <option value="completed">Completed Tasks</option>
              </select>
            </div>
            <div class="col-md-6">
              <select class="form-select" id="sortSelect">
                <option value="dateAsc">Sort: Deadline (Earliest First)</option>
                <option value="dateDesc">Sort: Deadline (Latest First)</option>
                <option value="newest">Sort: Newest First</option>
                <option value="oldest">Sort: Oldest First</option>
              </select>
            </div>
          </div>

          <!-- Task List -->
          <div id="taskList"></div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
      let tasks = [];
      let editingId = null;

      const taskForm = document.getElementById("taskForm");
      const taskInput = document.getElementById("taskInput");
      const deadlineInput = document.getElementById("deadlineInput");
      const submitBtn = document.getElementById("submitBtn");
      const taskList = document.getElementById("taskList");
      const filterSelect = document.getElementById("filterSelect");
      const sortSelect = document.getElementById("sortSelect");

      // Set minimum date to today
      deadlineInput.min = new Date().toISOString().split("T")[0];

      taskForm.addEventListener("submit", function (e) {
        e.preventDefault();
        console.log("Form submitted"); // Debug log
        if (editingId !== null) {
          updateTask();
        } else {
          addTask();
        }
      });

      filterSelect.addEventListener("change", renderTasks);
      sortSelect.addEventListener("change", renderTasks);

      function addTask() {
        console.log("Adding task"); // Debug log
        const taskText = taskInput.value.trim();
        const taskDeadline = deadlineInput.value;

        console.log("Task:", taskText, "Deadline:", taskDeadline); // Debug log

        if (!taskText || !taskDeadline) {
          alert("Please fill in both task and deadline");
          return;
        }

        const task = {
          id: Date.now(),
          text: taskText,
          deadline: taskDeadline,
          completed: false,
          createdAt: Date.now(),
        };
        tasks.push(task);
        console.log("Tasks array:", tasks); // Debug log
        taskInput.value = "";
        deadlineInput.value = "";
        renderTasks();
      }

      function updateTask() {
        const task = tasks.find((t) => t.id === editingId);
        task.text = taskInput.value.trim();
        task.deadline = deadlineInput.value;

        taskInput.value = "";
        deadlineInput.value = "";
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add';
        submitBtn.classList.remove("btn-warning");
        submitBtn.classList.add("btn-success");
        editingId = null;

        renderTasks();
      }

      function editTask(id) {
        const task = tasks.find((t) => t.id === id);
        taskInput.value = task.text;
        deadlineInput.value = task.deadline;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update';
        submitBtn.classList.remove("btn-success");
        submitBtn.classList.add("btn-warning");
        editingId = id;
        taskInput.focus();
      }

      function deleteTask(id) {
        if (confirm("Are you sure you want to delete this task?")) {
          tasks = tasks.filter((t) => t.id !== id);
          renderTasks();
        }
      }

      function toggleComplete(id) {
        const task = tasks.find((t) => t.id === id);
        task.completed = !task.completed;
        renderTasks();
      }

      function getDeadlineStatus(deadline) {
        const today = new Date().toISOString().split("T")[0];
        if (deadline < today) return "passed";
        if (deadline === today) return "today";
        return "upcoming";
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
          year: "numeric",
        });
      }

      function filterTasks(tasks) {
        const filter = filterSelect.value;
        if (filter === "active") return tasks.filter((t) => !t.completed);
        if (filter === "completed") return tasks.filter((t) => t.completed);
        return tasks;
      }

      function sortTasks(tasks) {
        const sort = sortSelect.value;
        const sorted = [...tasks];

        if (sort === "dateAsc") {
          sorted.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
        } else if (sort === "dateDesc") {
          sorted.sort((a, b) => new Date(b.deadline) - new Date(a.deadline));
        } else if (sort === "newest") {
          sorted.sort((a, b) => b.createdAt - a.createdAt);
        } else if (sort === "oldest") {
          sorted.sort((a, b) => a.createdAt - b.createdAt);
        }

        return sorted;
      }

      function renderTasks() {
        let filteredTasks = filterTasks(tasks);
        let sortedTasks = sortTasks(filteredTasks);

        if (sortedTasks.length === 0) {
          taskList.innerHTML =
            '<p class="text-center text-muted">No tasks to display. Add your first task above!</p>';
          return;
        }

        taskList.innerHTML = sortedTasks
          .map((task) => {
            const status = getDeadlineStatus(task.deadline);
            const statusClass =
              status === "passed"
                ? "deadline-passed"
                : status === "today"
                ? "deadline-today"
                : "";
            const completedClass = task.completed ? "task-completed" : "";

            return `
                    <div class="card mb-2 task-item ${statusClass}">
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="flex-grow-1">
                                    <div class="form-check d-inline-block">
                                        <input class="form-check-input" type="checkbox" ${
                                          task.completed ? "checked" : ""
                                        } 
                                               onchange="toggleComplete(${
                                                 task.id
                                               })">
                                    </div>
                                    <span class="${completedClass} ms-2">${
              task.text
            }</span>
                                    <br>
                                    <small class="text-muted ms-4">
                                        <i class="fas fa-calendar"></i> ${formatDate(
                                          task.deadline
                                        )}
                                        ${
                                          status === "passed"
                                            ? '<span class="badge bg-danger ms-1">Overdue</span>'
                                            : ""
                                        }
                                        ${
                                          status === "today"
                                            ? '<span class="badge bg-warning ms-1">Today</span>'
                                            : ""
                                        }
                                    </small>
                                </div>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-primary btn-action" onclick="editTask(${
                                      task.id
                                    })" ${task.completed ? "disabled" : ""}>
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger btn-action" onclick="deleteTask(${
                                      task.id
                                    })">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      renderTasks();
    </script>
  </body>
</html>
